<Layout::Section::Header @title="Báo cáo Công Nợ">
    {{!-- <Button @icon="refresh" @onClick={{this.reload}} @helpText={{t "fleet-ops.common.reload-data"}} class="mr-2" /> --}}
    <Button @icon="plus" @iconPrefix="fas" @type="primary" @text={{t "fleet-ops.common.new"}} class="mr-2" @onClick={{this.openCreateOverlay}} @permission="fleet-ops create debt-reports" />
    
</Layout::Section::Header>

<div class="finance-management w-full flex flex-col items-center mt-6">
  <div class="w-full space-y-3">
    <form {{on "submit" this.search}} class="w-full px-4 mb-4 mx-auto">
        <div class="flex flex-wrap gap-4 items-center">
            {{!-- Ngày bắt đầu --}}
            <input
                type="date"
                class="form-input h-9 w-[160px]"
                value={{this.startDate}}
                {{on "change" this.updateStartDate}}
            />

            {{!-- Ngày kết thúc --}}
            <input
                type="date"
                class="form-input h-9 w-[160px]"
                value={{this.endDate}}
                {{on "change" this.updateEndDate}}
            />
            {{!-- Chọn khách hàng --}}
            <div class="w-[320px]">
                <ModelSelect
                    @modelName="customer"
                    @selectedModel={{this.selectedCustomer}}
                    @placeholder="-- Chọn khách hàng --"
                    @triggerClass="form-select form-input h-9 w-full !align-middle"
                    @allowClear={{true}}
                    @renderInPlace={{false}}
                    @infiniteScroll={{false}}
                    @onChange={{this.updateSelectedCustomer}}
                    as |model|
                >
                    <div class="flex items-center space-x-2">
                    <span class="uppercase">{{model.name}}</span>
                    </div>
                </ModelSelect>
            </div>

            {{!-- Nút tìm kiếm --}}
            <button
            type="submit"
            class="h-9 px-4 bg-blue-600 text-white rounded hover:bg-blue-700"
            >
            Tìm kiếm
            </button>
        </div>
    </form>
  </div>

  {{!-- Dòng 4: Kết quả thu chi - full màn hình --}}
  <div class="results w-full px-4 mt-6 overflow-auto">
  {{#if this.results.length}}
    <!-- Tổng hợp thu chi -->
    <div class="flex justify-end mb-2 text-sm text-gray-700 dark:text-gray-200 px-4">
        <div class="grid grid-cols-[auto,auto] gap-x-4 text-right">
            <span class="text-red-400">Dự thu:</span>
            <span class="font-semibold text-red-400">{{this.totalIncome}}</span>

            <span class="text-green-400">Đã nhận:</span>
            <span class="font-semibold text-green-400">{{this.totalExpense}}</span>

            <span class="text-yellow-400">Còn nợ:</span>
            <span class="font-semibold text-yellow-400">{{this.totalProfit}}</span>
        </div>
    </div>

    <table class="w-full table-auto text-sm">
      <thead>
        <tr class="text-gray-400 text-xs uppercase border-b border-gray-700">
          <th class="text-left py-2 pl-2">Ngày tháng</th>
          <th class="text-left py-2 pl-2">Số xe</th>
          <th class="text-left py-2 pl-2">Tên hàng</th>
          <th class="text-left py-2 pl-2">Chủ Hàng</th>
          <th class="text-left py-2 pl-2">Nơi nhận hàng</th>
          <th class="text-left py-2 pl-2">Nơi giao hàng</th>
          {{!-- <th class="text-left py-2 pl-2">ĐVT</th> --}}
          <th class="text-left py-2 pl-2">Số lượng</th>
          <th class="text-left py-2 pl-2">Đơn giá</th>
          <th class="text-left py-2 pl-2">Thành tiền</th>
          <th class="text-left py-2 pl-2">Trạng thái</th>
          <th class="text-left py-2 pl-2">Ghi Chú</th>
        </tr>
      </thead>
      <tbody>
        {{#each this.results as |item|}}
          <tr class="border-b border-gray-700 hover:bg-gray-800 transition">
            <td class="py-2 pl-2 text-white">{{item.date}}</td>
            <td class="py-2 pl-2 text-white">{{item.plate_number}}</td>
            <td class="py-2 pl-2 text-white">{{item.sku_name}}</td>
            <td class="py-2 pl-2 text-white">{{item.customerName}}</td>
            <td class="py-2 pl-2 text-white">{{item.pickup}}</td>
            <td class="py-2 pl-2 text-white">{{item.dropoff}}</td>
            {{!-- <td class="py-2 pl-2 text-white">{{item.weight_unit}}</td> --}}
            <td class="py-2 pl-2 text-white">{{item.quantity_fees}}</td>
            <td class="py-2 pl-2 text-white">{{item.unit_price_fees_display}}</td>
            <td class="py-2 pl-2 text-white">{{item.amount_display}}</td>
            <td class="py-2">
              {{#if (eq item.type "debt_estimate")}}
                <span class="text-red-400 pl-2 font-medium">Dự thu</span>
              {{else}}
                <span class="text-green-400 pl-2 font-medium">Đã nhận</span>
              {{/if}}
            </td>
            <td class="py-2 pl-2 text-white">{{item.note}}</td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  {{else}}
    <p class="text-gray-500 italic text-center">Không có dữ liệu.</p>
  {{/if}}
</div>
</div>

{{outlet}}